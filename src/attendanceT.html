<html>
    <head>
        <style>
            body *{
                font-family: monospace;
            }
            table{
                font-size: 15px;
                background-color: #9696db;
                table-layout: auto;
                border-collapse: collapse;
                border: 2px solid black;
            }
            td{
                border: 2px solid black;
                padding-left: 8px;
                padding-right: 8px;
            }
        </style>
        <script>
            window.onload = () =>{
                function generateTable(data, target){
                    let html = '';
                    data.forEach((el)=>{
                        html += '<tr>';
                        for(let key in el){
                            html+= '<td>'+el[key]+'</td>';
                        }
                        html += '</tr>';
                    })
                    target.innerHTML = html;
                }
                function xhr(method, url, data, cb){
                    let x = new XMLHttpRequest();
                    x.open(method, url);
                    x.onloadend= ()=>{
                        cb(x.responseText, x.status);
                    }
                    x.send(data);
                }
                let date = new Date();
                let today = {date: date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()}
                console.log(today);
                xhr("POST", "/db/attendance", JSON.stringify(today), (data,status)=>{
                    if(status ==200){
                        generateTable(JSON.parse(data), document.getElementById("target"));
                    }
                    else{
                        alert("AN ERROR OCCURRED");
                    }
                })
                let rel = true;
                let tim = setTimeout(()=>{location.reload()}, 3000);
                ch.onchange=()=>{
                    rel = !rel;
                    if(rel){
                        tim = setTimeout(()=>{location.reload()}, 3000);
                    }else{
                        clearTimeout(tim);
                    }
                }
                
            }
        </script>
    </head>
    <body>
        <input checked id=ch type="checkbox" ><span>Refresh every 3 seconds</span><br/>
        <table>
            <thead>
                <tr>
                    <th>day</th>
                    <th>name</th>
                    <th>id</th>
                    <th>hour</th>
                </tr>
            </thead>
            <tbody id="target" >
                
            </tbody>
        </table>
    </body>
</html>